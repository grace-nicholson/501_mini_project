#include "Arduino_BHY2Host.h" // Connects to the microcontroller

// Selects the appropriate sensor (in this case temperature)
Sensor temperature(SENSOR_ID_TEMP);

// Calibration constants (c and k inserted from my calibration to show how the code works. make sure to use your own values here)
const float c = 2.54473863697683;   // offset in Â°C 
const float k = 0.00129948823040357;  // drift per second

unsigned long startMillis;
float temperatureValue = 0; // variable storing the measured temperature; defined as 0 as measurements will be added to that value

void setup() {
  Serial.begin(115200);
  BHY2Host.begin();
  temperature.begin();

  startMillis = millis();  // start timer
}

void loop() {
  BHY2Host.update();

  temperatureValue = temperature.value(); // read temperature off the sensor

  float timeSec = (millis() - startMillis) / 1000.0; // convert time to seconds

  // Temperature correction application
  float correctedTemp = temperatureValue - (c + k * timeSec);

  // JSON friendly output
  Serial.print("{\"time_s\": ");
  Serial.print(timeSec);
  Serial.print(", \"measured\": ");
  Serial.print(temperatureValue);
  Serial.print(", \"corrected\": ");
  Serial.print(correctedTemp);
  Serial.println("}");

  delay(1000);
}
